{% extends "acbase.html" %}


{% block content %}
<div class="container mt-4">
    <h2>Edit Item in Scale: {{ scale.name }}</h2>

    <!-- Edit Form -->
    <form method="post" class="mb-4">
        {% csrf_token %}
        <div class="mb-3">
            {{ form.statement.label_tag }}
            {{ form.statement }}
        </div>
        <div class="mb-3">
            {{ form.option_set.label_tag }}
            {{ form.option_set }}
        </div>
        <button type="submit" class="btn btn-success">Update Item</button>
        <a href="{% url 'add_scale_Items' scale.id %}" class="btn btn-secondary">Cancel</a>
    </form>

    <!-- List of All Items in Scale -->
    <h3>Items in this Scale</h3>
    {% if items %}
        <div class="accordion mt-3" id="itemsAccordion">
            {% for i in items %}
            <div class="accordion-item mb-2">
                <h2 class="accordion-header" id="heading{{ forloop.counter }}">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}">
                        {{ forloop.counter }}. {{ i.statement }}
                        <small class="ms-2 text-muted">[Option Set: {{ i.option_set.name }}]</small>
                    </button>
                </h2>
                <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse" data-bs-parent="#itemsAccordion">
                    <div class="accordion-body">

                        <!-- Options List -->
                        <ul class="list-group mb-3">
                            {% for option in i.option_set.options.all %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                {{ option.text }}
                                <span class="badge bg-primary rounded-pill">{{ option.value }}</span>
                            </li>
                            {% empty %}
                            <li class="list-group-item text-muted">No options defined for this set.</li>
                            {% endfor %}
                        </ul>

                        <!-- Actions -->
                        <a href="{% url 'edit_scale_item' i.id %}" class="btn btn-sm btn-warning">Edit</a>
                        <a href="{% url 'delete_scale_item' i.id %}" class="btn btn-sm btn-danger"
                           onclick="return confirm('Are you sure you want to delete this item?');">
                            Delete
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-muted">No items have been added to this scale yet.</p>
    {% endif %}
</div>
{% endblock %}
