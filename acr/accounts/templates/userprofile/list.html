{% extends "acbase.html" %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center">User Profiles</h2>

    <!-- ✅ Search Box -->
    <div class="row mb-3">
        <div class="col-md-8">
            <input type="text" id="searchInput" 
                   class="form-control" 
                   placeholder="Search by username or display name..." 
                   onkeyup="searchTable()">
        </div>
        <div class="col-md-4 text-md-end mt-2 mt-md-0">
            <a href="{% url 'user_group_list' %}" class="btn btn-secondary w-100 w-md-auto">
                Users Groups
            </a>
        </div>
    </div>
    
    
    <table class="table table-bordered table-striped" id="userTable">
        <thead class="table-dark">
            <tr>
                <th>Username</th>
                <th>Display Name</th>
                <th colspan =3>Actions </th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.username }}</td>
                <td>{{ user.profile.display_name|default:"No Profile" }}</td>
                <td>
                    {% if user.profile %}
                    <a href="{% url 'edit_pro_user_profile' user.id %}" class="btn btn-primary btn-sm">Edit</a>
                    {% else %}
                    <a href="{% url 'edit_full_user_profile' user.id %}" class="btn btn-primary btn-sm">Create</a>
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'update_user_settings' user.id %}" class="btn btn-info btn-sm">Settings</a>
                </td>
                <td>
                    <a href="{% url 'manage_user_menu_permissions' user.id %}" class="btn btn-info btn-sm">Menu</a>
                </td>

                
            </tr>
            {% empty %}
            <tr>
                <td colspan="3" class="text-center">No users found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- ✅ Include JavaScript -->
<script>
    function searchTable() {
        let input = document.getElementById("searchInput").value.toLowerCase();
        let table = document.getElementById("userTable");
        let rows = table.getElementsByTagName("tr");

        for (let i = 1; i < rows.length; i++) {  // Skip the header row
            let username = rows[i].getElementsByTagName("td")[0]?.textContent.toLowerCase();
            let displayName = rows[i].getElementsByTagName("td")[1]?.textContent.toLowerCase();

            if (username.includes(input) || displayName.includes(input)) {
                rows[i].style.display = "";
            } else {
                rows[i].style.display = "none";
            }
        }
    }
</script>
{% endblock %}
