{% extends "acbase.html" %}
{% block content %}
<h2>Employee List</h2>
<div class="d-flex justify-content-between align-items-center mb-6">
    <!-- Right: Search Box -->
    <input type="text" id="searchInput" class="form-control w-auto" placeholder="Search employees...">
    <!-- Left: Add Employee button -->
    <a href="{% url 'create_employee' %}" class="btn btn-primary">
        Add Employee
    </a>
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">Employees</h5>
        <a href="{% url 'employee_bulk_upload' %}" class="btn btn-success">
          <i class="bi bi-upload"></i> Bulk Upload
        </a>
      </div>
      
      
</div>


<!-- Table -->
<table class="table table-bordered" id="employeeTable">
    <thead>
        <tr>
            <th>Emp Code</th>
            <th>Name</th>
            <th>Job Category</th>
            <th>Institute</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for employee in employees %}
        <tr>
            <td>{{ employee.emp_code }}</td>
            <td>{{ employee.emp_name }}</td>
            <td>
                {% if employee.job_categories.exists %}
                {% for jc in employee.job_categories.all %}
                {{ jc.category_name|default:jc.category_name }}<br>
                {% endfor %}
                {% else %}
                <em>None</em>
                {% endif %}
            </td>

            <td>
                {% for inst in employee.institutes.all %}
                {{ inst.short_name }}<br>
                {% empty %}
                <span class="text-muted">No Institute</span>
                {% endfor %}
            </td>
            <td>
                <a href="{% url 'view_employee_detail' employee.id %}" class="btn btn-info btn-sm">View</a>
                <a href="{% url 'edit_employee' employee.id %}" class="btn btn-warning btn-sm">Edit</a>
                <a href="{% url 'delete_employee' employee.id %}" class="btn btn-danger btn-sm">Delete</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Pagination Controls -->
<div id="paginationControls" class="mt-3"></div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const rows = Array.from(document.querySelectorAll("#employeeTable tbody tr"));
        const rowsPerPage = 10;
        let currentPage = 1;

        function displayTable(page) {
            const start = (page - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            rows.forEach((row, index) => {
                row.style.display = (index >= start && index < end) ? "" : "none";
            });
        }

        function setupPagination() {
            const totalPages = Math.ceil(rows.length / rowsPerPage);
            let paginationHTML = "";
            for (let i = 1; i <= totalPages; i++) {
                paginationHTML += `<button class="btn btn-sm ${i === currentPage ? 'btn-primary' : 'btn-outline-primary'} me-1" onclick="changePage(${i})">${i}</button>`;
            }
            document.getElementById("paginationControls").innerHTML = paginationHTML;
        }

        window.changePage = function (page) {
            currentPage = page;
            displayTable(page);
            setupPagination();
        };

        document.getElementById("searchInput").addEventListener("keyup", function () {
            const filter = this.value.toLowerCase();
            const filteredRows = rows.filter(row => row.textContent.toLowerCase().includes(filter));
            rows.forEach(row => row.style.display = "none");
            filteredRows.forEach(row => row.style.display = "");
            // Reset pagination after filtering
            if (filter === "") {
                displayTable(1);
                setupPagination();
            }
        });

        // Init
        displayTable(currentPage);
        setupPagination();
    });
</script>

{% endblock %}